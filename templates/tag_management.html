<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ ‡ç­¾åˆ†ç±»ç®¡ç† - çŸ¥è¯†å›¾è°±ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .stats-panel {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #007bff;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .control-panel {
            padding: 20px;
            background: white;
            border-bottom: 1px solid #e9ecef;
        }

        .control-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .control-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .control-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .search-box {
            position: relative;
            flex: 1;
            min-width: 250px;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px 12px 45px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .filter-panel {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-label {
            font-size: 12px;
            font-weight: 600;
            color: #666;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: white;
        }

        .tag-management {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            padding: 20px;
        }

        .category-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
        }

        .panel-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .category-tree {
            max-height: 500px;
            overflow-y: auto;
        }

        .category-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .category-item:hover {
            background: #e9ecef;
            border-color: #007bff;
        }

        .category-item.active {
            background: #007bff;
            color: white;
        }

        .category-icon {
            margin-right: 10px;
            font-size: 16px;
        }

        .category-name {
            flex: 1;
            font-weight: 500;
        }

        .category-count {
            background: rgba(0,123,255,0.1);
            color: #007bff;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .category-item.active .category-count {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .tag-panel {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
        }

        .tag-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .tag-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
            position: relative;
        }

        .tag-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .tag-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .tag-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .tag-name {
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .tag-actions {
            display: flex;
            gap: 5px;
        }

        .tag-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tag-btn-edit {
            background: #007bff;
            color: white;
        }

        .tag-btn-delete {
            background: #dc3545;
            color: white;
        }

        .tag-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: #666;
        }

        .tag-description {
            font-size: 13px;
            color: #666;
            margin-top: 8px;
            line-height: 1.4;
        }

        .tag-usage {
            background: #f8f9fa;
            border-radius: 4px;
            padding: 8px;
            margin-top: 10px;
            font-size: 12px;
        }

        .usage-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 6px;
            overflow: hidden;
            margin-top: 5px;
        }

        .usage-fill {
            background: linear-gradient(90deg, #007bff, #0056b3);
            height: 100%;
            transition: width 0.3s ease;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: #f8f9fa;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .color-picker {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: #333;
            transform: scale(1.2);
        }

        .batch-actions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px;
            display: none;
        }

        .batch-actions.active {
            display: block;
        }

        .batch-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .batch-title {
            font-weight: 600;
            color: #856404;
        }

        .batch-selected {
            color: #007bff;
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .empty-description {
            font-size: 14px;
            line-height: 1.5;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .tag-management {
                grid-template-columns: 1fr;
            }
            
            .control-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                min-width: auto;
            }
            
            .tag-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ·ï¸ æ ‡ç­¾åˆ†ç±»ç®¡ç†</h1>
            <p>ç®¡ç†å’Œç»„ç»‡æ‚¨çš„æ–‡æ¡£æ ‡ç­¾ä¸åˆ†ç±»ä½“ç³»</p>
        </div>

        <div class="main-content">
            <!-- ç»Ÿè®¡é¢æ¿ -->
            <div class="stats-panel">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalTags">156</div>
                        <div class="stat-label">æ€»æ ‡ç­¾æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalCategories">24</div>
                        <div class="stat-label">åˆ†ç±»æ•°é‡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="mostUsedTag">çŸ¥è¯†å›¾è°±</div>
                        <div class="stat-label">æœ€å¸¸ç”¨æ ‡ç­¾</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="unusedTags">12</div>
                        <div class="stat-label">æœªä½¿ç”¨æ ‡ç­¾</div>
                    </div>
                </div>
            </div>

            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="control-panel">
                <div class="control-header">
                    <div class="control-title">æ ‡ç­¾ç®¡ç†æ§åˆ¶å°</div>
                    <div class="control-actions">
                        <div class="search-box">
                            <span class="search-icon">ğŸ”</span>
                            <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢æ ‡ç­¾åç§°ã€æè¿°æˆ–å…³é”®è¯...">
                        </div>
                        <button class="btn btn-primary" onclick="showAddTagModal()">
                            <span>â•</span>
                            <span>æ–°å»ºæ ‡ç­¾</span>
                        </button>
                        <button class="btn btn-success" onclick="showAddCategoryModal()">
                            <span>ğŸ“</span>
                            <span>æ–°å»ºåˆ†ç±»</span>
                        </button>
                    </div>
                </div>

                <div class="filter-panel">
                    <div class="filter-group">
                        <label class="filter-label">åˆ†ç±»ç­›é€‰</label>
                        <select class="filter-select" id="categoryFilter" onchange="filterTags()">
                            <option value="">å…¨éƒ¨åˆ†ç±»</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">ä½¿ç”¨çŠ¶æ€</label>
                        <select class="filter-select" id="usageFilter" onchange="filterTags()">
                            <option value="">å…¨éƒ¨çŠ¶æ€</option>
                            <option value="used">å·²ä½¿ç”¨</option>
                            <option value="unused">æœªä½¿ç”¨</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">æ’åºæ–¹å¼</label>
                        <select class="filter-select" id="sortFilter" onchange="sortTags()">
                            <option value="name">æŒ‰åç§°</option>
                            <option value="usage">æŒ‰ä½¿ç”¨é¢‘ç‡</option>
                            <option value="created">æŒ‰åˆ›å»ºæ—¶é—´</option>
                            <option value="updated">æŒ‰æ›´æ–°æ—¶é—´</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- æ‰¹é‡æ“ä½œé¢æ¿ -->
            <div class="batch-actions" id="batchActions">
                <div class="batch-header">
                    <div class="batch-title">
                        <span>æ‰¹é‡æ“ä½œ</span>
                        <span class="batch-selected" id="selectedCount">å·²é€‰æ‹© 0 ä¸ªæ ‡ç­¾</span>
                    </div>
                    <div class="control-actions">
                        <button class="btn btn-warning" onclick="batchEdit()">âœï¸ æ‰¹é‡ç¼–è¾‘</button>
                        <button class="btn btn-danger" onclick="batchDelete()">ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤</button>
                        <button class="btn btn-secondary" onclick="clearSelection()">âŒ å–æ¶ˆé€‰æ‹©</button>
                    </div>
                </div>
            </div>

            <!-- æ ‡ç­¾ç®¡ç†åŒºåŸŸ -->
            <div class="tag-management">
                <!-- åˆ†ç±»æ ‘ -->
                <div class="category-panel">
                    <div class="panel-title">ğŸ“‚ åˆ†ç±»ç®¡ç†</div>
                    <div class="category-tree" id="categoryTree">
                        <!-- åˆ†ç±»æ ‘å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- æ ‡ç­¾ç½‘æ ¼ -->
                <div class="tag-panel">
                    <div class="panel-title">ğŸ·ï¸ æ ‡ç­¾åˆ—è¡¨</div>
                    <div class="tag-grid" id="tagGrid">
                        <!-- æ ‡ç­¾å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div class="empty-state" id="emptyState" style="display: none;">
                        <div class="empty-icon">ğŸ·ï¸</div>
                        <div class="empty-title">æš‚æ— æ ‡ç­¾</div>
                        <div class="empty-description">
                            å½“å‰åˆ†ç±»ä¸‹è¿˜æ²¡æœ‰æ ‡ç­¾ï¼Œç‚¹å‡»ä¸Šæ–¹"æ–°å»ºæ ‡ç­¾"æŒ‰é’®åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªæ ‡ç­¾å§ï¼
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ /ç¼–è¾‘æ ‡ç­¾æ¨¡æ€æ¡† -->
    <div class="modal" id="tagModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="tagModalTitle">æ–°å»ºæ ‡ç­¾</div>
                <button class="modal-close" onclick="closeTagModal()">&times;</button>
            </div>
            <form id="tagForm" onsubmit="saveTag(event)">
                <div class="form-group">
                    <label class="form-label">æ ‡ç­¾åç§° *</label>
                    <input type="text" class="form-input" id="tagName" required placeholder="è¯·è¾“å…¥æ ‡ç­¾åç§°">
                </div>
                <div class="form-group">
                    <label class="form-label">æ ‡ç­¾æè¿°</label>
                    <textarea class="form-textarea" id="tagDescription" placeholder="è¯·è¾“å…¥æ ‡ç­¾æè¿°ï¼ˆå¯é€‰ï¼‰"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">æ‰€å±åˆ†ç±»</label>
                    <select class="form-select" id="tagCategory" required>
                        <option value="">è¯·é€‰æ‹©åˆ†ç±»</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">æ ‡ç­¾é¢œè‰²</label>
                    <div class="color-picker" id="colorPicker">
                        <div class="color-option selected" style="background: #007bff" data-color="#007bff"></div>
                        <div class="color-option" style="background: #28a745" data-color="#28a745"></div>
                        <div class="color-option" style="background: #dc3545" data-color="#dc3545"></div>
                        <div class="color-option" style="background: #ffc107" data-color="#ffc107"></div>
                        <div class="color-option" style="background: #17a2b8" data-color="#17a2b8"></div>
                        <div class="color-option" style="background: #6f42c1" data-color="#6f42c1"></div>
                        <div class="color-option" style="background: #e83e8c" data-color="#e83e8c"></div>
                        <div class="color-option" style="background: #fd7e14" data-color="#fd7e14"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">å…³é”®è¯ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
                    <input type="text" class="form-input" id="tagKeywords" placeholder="ä¾‹å¦‚: AI,äººå·¥æ™ºèƒ½,æœºå™¨å­¦ä¹ ">
                </div>
                <div class="btn-group" style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeTagModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">ä¿å­˜æ ‡ç­¾</button>
                </div>
            </form>
        </div>
    </div>

    <!-- æ·»åŠ /ç¼–è¾‘åˆ†ç±»æ¨¡æ€æ¡† -->
    <div class="modal" id="categoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="categoryModalTitle">æ–°å»ºåˆ†ç±»</div>
                <button class="modal-close" onclick="closeCategoryModal()">&times;</button>
            </div>
            <form id="categoryForm" onsubmit="saveCategory(event)">
                <div class="form-group">
                    <label class="form-label">åˆ†ç±»åç§° *</label>
                    <input type="text" class="form-input" id="categoryName" required placeholder="è¯·è¾“å…¥åˆ†ç±»åç§°">
                </div>
                <div class="form-group">
                    <label class="form-label">åˆ†ç±»æè¿°</label>
                    <textarea class="form-textarea" id="categoryDescription" placeholder="è¯·è¾“å…¥åˆ†ç±»æè¿°ï¼ˆå¯é€‰ï¼‰"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">ä¸Šçº§åˆ†ç±»</label>
                    <select class="form-select" id="parentCategory">
                        <option value="">é¡¶çº§åˆ†ç±»</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">åˆ†ç±»å›¾æ ‡</label>
                    <input type="text" class="form-input" id="categoryIcon" placeholder="ä¾‹å¦‚: ğŸ“, ğŸ·ï¸, ğŸ“š">
                </div>
                <div class="btn-group" style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeCategoryModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-success">ä¿å­˜åˆ†ç±»</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let tags = [];
        let categories = [];
        let selectedTags = new Set();
        let currentEditingTag = null;
        let currentEditingCategory = null;
        let currentCategory = null;

        // åˆå§‹åŒ–æ•°æ®
        function initializeData() {
            // æ¨¡æ‹Ÿåˆ†ç±»æ•°æ®
            categories = [
                { id: 1, name: 'æŠ€æœ¯é¢†åŸŸ', icon: 'ğŸ’»', description: 'æŠ€æœ¯ç›¸å…³æ ‡ç­¾', parentId: null, level: 0 },
                { id: 2, name: 'äººå·¥æ™ºèƒ½', icon: 'ğŸ¤–', description: 'AIç›¸å…³æ ‡ç­¾', parentId: 1, level: 1 },
                { id: 3, name: 'æœºå™¨å­¦ä¹ ', icon: 'ğŸ§ ', description: 'MLç›¸å…³æ ‡ç­¾', parentId: 2, level: 2 },
                { id: 4, name: 'æ·±åº¦å­¦ä¹ ', icon: 'ğŸ”¬', description: 'DLç›¸å…³æ ‡ç­¾', parentId: 2, level: 2 },
                { id: 5, name: 'ä¸šåŠ¡é¢†åŸŸ', icon: 'ğŸ’¼', description: 'ä¸šåŠ¡ç›¸å…³æ ‡ç­¾', parentId: null, level: 0 },
                { id: 6, name: 'é‡‘èè¡Œä¸š', icon: 'ğŸ¦', description: 'é‡‘èç›¸å…³æ ‡ç­¾', parentId: 5, level: 1 },
                { id: 7, name: 'åŒ»ç–—è¡Œä¸š', icon: 'ğŸ¥', description: 'åŒ»ç–—ç›¸å…³æ ‡ç­¾', parentId: 5, level: 1 },
                { id: 8, name: 'æ•™è‚²é¢†åŸŸ', icon: 'ğŸ“', description: 'æ•™è‚²ç›¸å…³æ ‡ç­¾', parentId: null, level: 0 }
            ];

            // æ¨¡æ‹Ÿæ ‡ç­¾æ•°æ®
            tags = [
                { id: 1, name: 'çŸ¥è¯†å›¾è°±', description: 'çŸ¥è¯†å›¾è°±ç›¸å…³æ–‡æ¡£', categoryId: 3, color: '#007bff', keywords: ['KG', 'çŸ¥è¯†å›¾è°±', 'å›¾è°±'], usage: 45, createdAt: '2024-01-01', updatedAt: '2024-01-15' },
                { id: 2, name: 'è‡ªç„¶è¯­è¨€å¤„ç†', description: 'NLPç›¸å…³æŠ€æœ¯å’Œåº”ç”¨', categoryId: 2, color: '#28a745', keywords: ['NLP', 'è‡ªç„¶è¯­è¨€', 'æ–‡æœ¬å¤„ç†'], usage: 38, createdAt: '2024-01-02', updatedAt: '2024-01-14' },
                { id: 3, name: 'æ·±åº¦å­¦ä¹ ', description: 'æ·±åº¦å­¦ä¹ ç®—æ³•å’Œæ¨¡å‹', categoryId: 4, color: '#dc3545', keywords: ['DL', 'æ·±åº¦å­¦ä¹ ', 'ç¥ç»ç½‘ç»œ'], usage: 32, createdAt: '2024-01-03', updatedAt: '2024-01-13' },
                { id: 4, name: 'é‡‘èé£é™©', description: 'é‡‘èé£é™©è¯„ä¼°å’Œç®¡ç†', categoryId: 6, color: '#ffc107', keywords: ['é£é™©', 'é‡‘è', 'è¯„ä¼°'], usage: 28, createdAt: '2024-01-04', updatedAt: '2024-01-12' },
                { id: 5, name: 'åŒ»ç–—è¯Šæ–­', description: 'åŒ»ç–—è¯Šæ–­è¾…åŠ©ç³»ç»Ÿ', categoryId: 7, color: '#17a2b8', keywords: ['åŒ»ç–—', 'è¯Šæ–­', 'å¥åº·'], usage: 25, createdAt: '2024-01-05', updatedAt: '2024-01-11' },
                { id: 6, name: 'åœ¨çº¿æ•™è‚²', description: 'åœ¨çº¿æ•™è‚²å¹³å°å’ŒæŠ€æœ¯', categoryId: 8, color: '#6f42c1', keywords: ['æ•™è‚²', 'åœ¨çº¿', 'å­¦ä¹ '], usage: 22, createdAt: '2024-01-06', updatedAt: '2024-01-10' },
                { id: 7, name: 'æ•°æ®æŒ–æ˜', description: 'æ•°æ®æŒ–æ˜å’Œåˆ†ææŠ€æœ¯', categoryId: 3, color: '#e83e8c', keywords: ['æŒ–æ˜', 'æ•°æ®', 'åˆ†æ'], usage: 18, createdAt: '2024-01-07', updatedAt: '2024-01-09' },
                { id: 8, name: 'è®¡ç®—æœºè§†è§‰', description: 'è®¡ç®—æœºè§†è§‰å’Œå›¾åƒå¤„ç†', categoryId: 4, color: '#fd7e14', keywords: ['è§†è§‰', 'å›¾åƒ', 'CV'], usage: 15, createdAt: '2024-01-08', updatedAt: '2024-01-08' }
            ];

            renderCategoryTree();
            renderTags();
            updateStats();
            populateSelects();
            setupEventListeners();
        }

        // æ¸²æŸ“åˆ†ç±»æ ‘
        function renderCategoryTree() {
            const treeContainer = document.getElementById('categoryTree');
            const rootCategories = categories.filter(cat => cat.parentId === null);
            
            treeContainer.innerHTML = `
                <div class="category-item ${!currentCategory ? 'active' : ''}" onclick="selectCategory(null)">
                    <span class="category-icon">ğŸ·ï¸</span>
                    <span class="category-name">å…¨éƒ¨æ ‡ç­¾</span>
                    <span class="category-count">${tags.length}</span>
                </div>
                ${rootCategories.map(category => renderCategoryNode(category)).join('')}
            `;
        }

        function renderCategoryNode(category) {
            const children = categories.filter(cat => cat.parentId === category.id);
            const categoryTags = tags.filter(tag => tag.categoryId === category.id);
            const indent = 'margin-left: ' + (category.level * 20) + 'px;';
            
            return `
                <div class="category-item ${currentCategory === category.id ? 'active' : ''}" 
                     onclick="selectCategory(${category.id})" style="${indent}">
                    <span class="category-icon">${category.icon}</span>
                    <span class="category-name">${category.name}</span>
                    <span class="category-count">${categoryTags.length}</span>
                </div>
                ${children.map(child => renderCategoryNode(child)).join('')}
            `;
        }

        // é€‰æ‹©åˆ†ç±»
        function selectCategory(categoryId) {
            currentCategory = categoryId;
            renderCategoryTree();
            renderTags();
        }

        // æ¸²æŸ“æ ‡ç­¾
        function renderTags() {
            const tagGrid = document.getElementById('tagGrid');
            const emptyState = document.getElementById('emptyState');
            
            let filteredTags = tags;
            
            // æŒ‰åˆ†ç±»ç­›é€‰
            if (currentCategory) {
                filteredTags = filteredTags.filter(tag => tag.categoryId === currentCategory);
            }
            
            // æŒ‰æœç´¢è¯ç­›é€‰
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                filteredTags = filteredTags.filter(tag => 
                    tag.name.toLowerCase().includes(searchTerm) ||
                    tag.description.toLowerCase().includes(searchTerm) ||
                    tag.keywords.some(keyword => keyword.toLowerCase().includes(searchTerm))
                );
            }
            
            // æŒ‰ä½¿ç”¨çŠ¶æ€ç­›é€‰
            const usageFilter = document.getElementById('usageFilter').value;
            if (usageFilter === 'used') {
                filteredTags = filteredTags.filter(tag => tag.usage > 0);
            } else if (usageFilter === 'unused') {
                filteredTags = filteredTags.filter(tag => tag.usage === 0);
            }
            
            if (filteredTags.length === 0) {
                tagGrid.style.display = 'none';
                emptyState.style.display = 'block';
            } else {
                tagGrid.style.display = 'grid';
                emptyState.style.display = 'none';
                
                tagGrid.innerHTML = filteredTags.map(tag => `
                    <div class="tag-card" data-tag-id="${tag.id}">
                        <div class="tag-header">
                            <div class="tag-color" style="background: ${tag.color}"></div>
                            <div class="tag-name">${tag.name}</div>
                            <input type="checkbox" class="tag-checkbox" style="margin-left: auto;" 
                                   onchange="toggleTagSelection(${tag.id})" 
                                   ${selectedTags.has(tag.id) ? 'checked' : ''}>
                        </div>
                        <div class="tag-description">${tag.description}</div>
                        <div class="tag-stats">
                            <span>ä½¿ç”¨æ¬¡æ•°: <strong>${tag.usage}</strong></span>
                            <span>å…³é”®è¯: <strong>${tag.keywords.length}</strong></span>
                        </div>
                        <div class="tag-usage">
                            <div>ä½¿ç”¨é¢‘ç‡</div>
                            <div class="usage-bar">
                                <div class="usage-fill" style="width: ${Math.min(tag.usage * 2, 100)}%"></div>
                            </div>
                        </div>
                        <div class="tag-actions">
                            <button class="tag-btn tag-btn-edit" onclick="editTag(${tag.id})">âœï¸ ç¼–è¾‘</button>
                            <button class="tag-btn tag-btn-delete" onclick="deleteTag(${tag.id})">ğŸ—‘ï¸ åˆ é™¤</button>
                        </div>
                    </div>
                `).join('');
            }
        }

        // æœç´¢åŠŸèƒ½
        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', renderTags);
            document.getElementById('categoryFilter').addEventListener('change', filterTags);
            document.getElementById('usageFilter').addEventListener('change', filterTags);
            document.getElementById('sortFilter').addEventListener('change', sortTags);
            
            // é¢œè‰²é€‰æ‹©å™¨
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.color-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
        }

        // ç­›é€‰æ ‡ç­¾
        function filterTags() {
            renderTags();
        }

        // æ’åºæ ‡ç­¾
        function sortTags() {
            const sortBy = document.getElementById('sortFilter').value;
            tags.sort((a, b) => {
                switch (sortBy) {
                    case 'name':
                        return a.name.localeCompare(b.name);
                    case 'usage':
                        return b.usage - a.usage;
                    case 'created':
                        return new Date(b.createdAt) - new Date(a.createdAt);
                    case 'updated':
                        return new Date(b.updatedAt) - new Date(a.updatedAt);
                    default:
                        return 0;
                }
            });
            renderTags();
        }

        // åˆ‡æ¢æ ‡ç­¾é€‰æ‹©
        function toggleTagSelection(tagId) {
            if (selectedTags.has(tagId)) {
                selectedTags.delete(tagId);
            } else {
                selectedTags.add(tagId);
            }
            updateBatchActions();
        }

        // æ›´æ–°æ‰¹é‡æ“ä½œé¢æ¿
        function updateBatchActions() {
            const batchActions = document.getElementById('batchActions');
            const selectedCount = document.getElementById('selectedCount');
            
            if (selectedTags.size > 0) {
                batchActions.classList.add('active');
                selectedCount.textContent = `å·²é€‰æ‹© ${selectedTags.size} ä¸ªæ ‡ç­¾`;
            } else {
                batchActions.classList.remove('active');
            }
        }

        // æ¸…ç©ºé€‰æ‹©
        function clearSelection() {
            selectedTags.clear();
            document.querySelectorAll('.tag-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            updateBatchActions();
        }

        // æ‰¹é‡ç¼–è¾‘
        function batchEdit() {
            if (selectedTags.size === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦ç¼–è¾‘çš„æ ‡ç­¾');
                return;
            }
            alert(`æ‰¹é‡ç¼–è¾‘ ${selectedTags.size} ä¸ªæ ‡ç­¾çš„åŠŸèƒ½å¼€å‘ä¸­...`);
        }

        // æ‰¹é‡åˆ é™¤
        function batchDelete() {
            if (selectedTags.size === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„æ ‡ç­¾');
                return;
            }
            
            if (confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedTags.size} ä¸ªæ ‡ç­¾å—ï¼Ÿ`)) {
                tags = tags.filter(tag => !selectedTags.has(tag.id));
                selectedTags.clear();
                renderTags();
                renderCategoryTree();
                updateStats();
                updateBatchActions();
                alert('æ‰¹é‡åˆ é™¤æˆåŠŸï¼');
            }
        }

        // æ¨¡æ€æ¡†åŠŸèƒ½
        function showAddTagModal() {
            currentEditingTag = null;
            document.getElementById('tagModalTitle').textContent = 'æ–°å»ºæ ‡ç­¾';
            document.getElementById('tagForm').reset();
            document.getElementById('tagModal').classList.add('active');
        }

        function showAddCategoryModal() {
            currentEditingCategory = null;
            document.getElementById('categoryModalTitle').textContent = 'æ–°å»ºåˆ†ç±»';
            document.getElementById('categoryForm').reset();
            document.getElementById('categoryModal').classList.add('active');
        }

        function closeTagModal() {
            document.getElementById('tagModal').classList.remove('active');
        }

        function closeCategoryModal() {
            document.getElementById('categoryModal').classList.remove('active');
        }

        // ç¼–è¾‘æ ‡ç­¾
        function editTag(tagId) {
            const tag = tags.find(t => t.id === tagId);
            if (tag) {
                currentEditingTag = tag;
                document.getElementById('tagModalTitle').textContent = 'ç¼–è¾‘æ ‡ç­¾';
                document.getElementById('tagName').value = tag.name;
                document.getElementById('tagDescription').value = tag.description;
                document.getElementById('tagCategory').value = tag.categoryId;
                document.getElementById('tagKeywords').value = tag.keywords.join(', ');
                
                // è®¾ç½®é¢œè‰²
                document.querySelectorAll('.color-option').forEach(option => {
                    option.classList.remove('selected');
                    if (option.dataset.color === tag.color) {
                        option.classList.add('selected');
                    }
                });
                
                document.getElementById('tagModal').classList.add('active');
            }
        }

        // åˆ é™¤æ ‡ç­¾
        function deleteTag(tagId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ ‡ç­¾å—ï¼Ÿ')) {
                tags = tags.filter(tag => tag.id !== tagId);
                selectedTags.delete(tagId);
                renderTags();
                renderCategoryTree();
                updateStats();
                updateBatchActions();
                alert('æ ‡ç­¾åˆ é™¤æˆåŠŸï¼');
            }
        }

        // ä¿å­˜æ ‡ç­¾
        function saveTag(event) {
            event.preventDefault();
            
            const name = document.getElementById('tagName').value;
            const description = document.getElementById('tagDescription').value;
            const categoryId = parseInt(document.getElementById('tagCategory').value);
            const keywords = document.getElementById('tagKeywords').value.split(',').map(k => k.trim()).filter(k => k);
            const color = document.querySelector('.color-option.selected').dataset.color;
            
            if (currentEditingTag) {
                // ç¼–è¾‘ç°æœ‰æ ‡ç­¾
                currentEditingTag.name = name;
                currentEditingTag.description = description;
                currentEditingTag.categoryId = categoryId;
                currentEditingTag.keywords = keywords;
                currentEditingTag.color = color;
                currentEditingTag.updatedAt = new Date().toISOString().slice(0, 10);
            } else {
                // åˆ›å»ºæ–°æ ‡ç­¾
                const newTag = {
                    id: Date.now(),
                    name: name,
                    description: description,
                    categoryId: categoryId,
                    color: color,
                    keywords: keywords,
                    usage: 0,
                    createdAt: new Date().toISOString().slice(0, 10),
                    updatedAt: new Date().toISOString().slice(0, 10)
                };
                tags.push(newTag);
            }
            
            renderTags();
            renderCategoryTree();
            updateStats();
            closeTagModal();
            alert(currentEditingTag ? 'æ ‡ç­¾æ›´æ–°æˆåŠŸï¼' : 'æ ‡ç­¾åˆ›å»ºæˆåŠŸï¼');
        }

        // ä¿å­˜åˆ†ç±»
        function saveCategory(event) {
            event.preventDefault();
            
            const name = document.getElementById('categoryName').value;
            const description = document.getElementById('categoryDescription').value;
            const parentId = document.getElementById('parentCategory').value ? parseInt(document.getElementById('parentCategory').value) : null;
            const icon = document.getElementById('categoryIcon').value || 'ğŸ“';
            
            if (currentEditingCategory) {
                // ç¼–è¾‘ç°æœ‰åˆ†ç±»
                currentEditingCategory.name = name;
                currentEditingCategory.description = description;
                currentEditingCategory.parentId = parentId;
                currentEditingCategory.icon = icon;
            } else {
                // åˆ›å»ºæ–°åˆ†ç±»
                const level = parentId ? categories.find(cat => cat.id === parentId).level + 1 : 0;
                const newCategory = {
                    id: Date.now(),
                    name: name,
                    icon: icon,
                    description: description,
                    parentId: parentId,
                    level: level
                };
                categories.push(newCategory);
            }
            
            renderCategoryTree();
            populateSelects();
            closeCategoryModal();
            alert(currentEditingCategory ? 'åˆ†ç±»æ›´æ–°æˆåŠŸï¼' : 'åˆ†ç±»åˆ›å»ºæˆåŠŸï¼');
        }

        // å¡«å……ä¸‹æ‹‰é€‰æ‹©æ¡†
        function populateSelects() {
            const categorySelect = document.getElementById('tagCategory');
            const categoryFilter = document.getElementById('categoryFilter');
            const parentCategorySelect = document.getElementById('parentCategory');
            
            const options = categories.map(cat => {
                const indent = '&nbsp;&nbsp;'.repeat(cat.level);
                return `<option value="${cat.id}">${indent}${cat.icon} ${cat.name}</option>`;
            }).join('');
            
            categorySelect.innerHTML = '<option value="">è¯·é€‰æ‹©åˆ†ç±»</option>' + options;
            categoryFilter.innerHTML = '<option value="">å…¨éƒ¨åˆ†ç±»</option>' + options;
            parentCategorySelect.innerHTML = '<option value="">é¡¶çº§åˆ†ç±»</option>' + options;
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            document.getElementById('totalTags').textContent = tags.length;
            document.getElementById('totalCategories').textContent = categories.length;
            
            const mostUsedTag = tags.reduce((max, tag) => tag.usage > max.usage ? tag : max, tags[0]);
            document.getElementById('mostUsedTag').textContent = mostUsedTag ? mostUsedTag.name : 'N/A';
            
            const unusedTags = tags.filter(tag => tag.usage === 0).length;
            document.getElementById('unusedTags').textContent = unusedTags;
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initializeData);
    </script>
</body>
</html>