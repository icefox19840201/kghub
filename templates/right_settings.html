<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒé™ç®¡æ§ç®¡ç† - çŸ¥è¯†å›¾è°±ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .stats-panel {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #007bff;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .control-panel {
            padding: 20px;
            background: white;
            border-bottom: 1px solid #e9ecef;
        }

        .control-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .control-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .control-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .search-box {
            position: relative;
            flex: 1;
            min-width: 250px;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px 12px 45px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .permission-management {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            padding: 20px;
        }

        .role-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
        }

        .permission-panel {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
        }

        .panel-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .role-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .role-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            margin: 5px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            background: white;
        }

        .role-item:hover {
            background: #e9ecef;
            border-color: #007bff;
        }

        .role-item.active {
            background: #007bff;
            color: white;
        }

        .role-info {
            flex: 1;
        }

        .role-name {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .role-description {
            font-size: 12px;
            opacity: 0.8;
        }

        .role-count {
            background: rgba(0,123,255,0.1);
            color: #007bff;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .role-item.active .role-count {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .permission-tree {
            max-height: 400px;
            overflow-y: auto;
        }

        .permission-group {
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
        }

        .permission-header {
            background: #f8f9fa;
            padding: 12px 15px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .permission-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            border-bottom: 1px solid #f0f0f0;
            background: white;
        }

        .permission-item:last-child {
            border-bottom: none;
        }

        .permission-info {
            flex: 1;
        }

        .permission-name {
            font-weight: 500;
            margin-bottom: 3px;
        }

        .permission-description {
            font-size: 12px;
            color: #666;
        }

        .permission-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .permission-toggle {
            position: relative;
            width: 50px;
            height: 24px;
            background: #ccc;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .permission-toggle.active {
            background: #28a745;
        }

        .permission-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .permission-toggle.active::after {
            transform: translateX(26px);
        }

        .permission-level {
            display: flex;
            gap: 5px;
        }

        .level-btn {
            padding: 4px 8px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .level-btn:hover {
            background: #f8f9fa;
        }

        .level-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .user-management {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .user-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .user-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .user-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .user-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #007bff;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 12px;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .user-email {
            font-size: 12px;
            color: #666;
        }

        .user-role {
            background: #e9ecef;
            color: #495057;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .audit-log {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }

        .log-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .log-table th,
        .log-table td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .log-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .log-table tr:hover {
            background: #f8f9fa;
        }

        .log-status {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .log-status.success {
            background: #d4edda;
            color: #155724;
        }

        .log-status.failed {
            background: #f8d7da;
            color: #721c24;
        }

        .log-status.warning {
            background: #fff3cd;
            color: #856404;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: #f8f9fa;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .permission-matrix {
            display: grid;
            grid-template-columns: 200px repeat(auto-fit, minmax(80px, 1fr));
            gap: 1px;
            background: #e9ecef;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 15px;
        }

        .matrix-header {
            background: #f8f9fa;
            padding: 10px;
            text-align: center;
            font-weight: 600;
            font-size: 12px;
        }

        .matrix-cell {
            background: white;
            padding: 10px;
            text-align: center;
        }

        .matrix-cell.resource {
            background: #f8f9fa;
            font-weight: 600;
            text-align: left;
        }

        .checkbox-custom {
            width: 18px;
            height: 18px;
            accent-color: #007bff;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .permission-management {
                grid-template-columns: 1fr;
            }
            
            .control-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                min-width: auto;
            }
            
            .user-grid {
                grid-template-columns: 1fr;
            }
            
            .permission-matrix {
                grid-template-columns: 150px repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” æƒé™ç®¡æ§ç®¡ç†</h1>
            <p>ç®¡ç†ç³»ç»Ÿç”¨æˆ·æƒé™ã€è§’è‰²åˆ†é…å’Œè®¿é—®æ§åˆ¶</p>
        </div>

        <div class="main-content">
            <!-- ç»Ÿè®¡é¢æ¿ -->
            <div class="stats-panel">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalUsers">128</div>
                        <div class="stat-label">æ€»ç”¨æˆ·æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalRoles">8</div>
                        <div class="stat-label">è§’è‰²æ•°é‡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activePermissions">156</div>
                        <div class="stat-label">æ´»è·ƒæƒé™</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="securityEvents">23</div>
                        <div class="stat-label">å®‰å…¨äº‹ä»¶</div>
                    </div>
                </div>
            </div>

            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="control-panel">
                <div class="control-header">
                    <div class="control-title">æƒé™ç®¡ç†æ§åˆ¶å°</div>
                    <div class="control-actions">
                        <div class="search-box">
                            <span class="search-icon">ğŸ”</span>
                            <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢ç”¨æˆ·ã€è§’è‰²æˆ–æƒé™...">
                        </div>
                        <button class="btn btn-primary" onclick="showAddRoleModal()">
                            <span>â•</span>
                            <span>æ–°å»ºè§’è‰²</span>
                        </button>
                        <button class="btn btn-success" onclick="showAddUserModal()">
                            <span>ğŸ‘¤</span>
                            <span>æ·»åŠ ç”¨æˆ·</span>
                        </button>
                        <button class="btn btn-warning" onclick="showPermissionMatrix()">
                            <span>ğŸ”§</span>
                            <span>æƒé™çŸ©é˜µ</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- æƒé™ç®¡ç†åŒºåŸŸ -->
            <div class="permission-management">
                <!-- è§’è‰²åˆ—è¡¨ -->
                <div class="role-panel">
                    <div class="panel-title">ğŸ‘¥ è§’è‰²ç®¡ç†</div>
                    <div class="role-list" id="roleList">
                        <!-- è§’è‰²åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- æƒé™é…ç½® -->
                <div class="permission-panel">
                    <div class="panel-title">ğŸ”‘ æƒé™é…ç½®</div>
                    <div class="permission-tree" id="permissionTree">
                        <!-- æƒé™æ ‘å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <!-- ç”¨æˆ·ç®¡ç† -->
            <div class="user-management">
                <div class="panel-title">ğŸ‘¨â€ğŸ’¼ ç”¨æˆ·ç®¡ç†</div>
                <div class="user-grid" id="userGrid">
                    <!-- ç”¨æˆ·å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- å®¡è®¡æ—¥å¿— -->
            <div class="audit-log">
                <div class="panel-title">ğŸ“‹ å®¡è®¡æ—¥å¿—</div>
                <div style="overflow-x: auto;">
                    <table class="log-table" id="auditLogTable">
                        <thead>
                            <tr>
                                <th>æ—¶é—´</th>
                                <th>ç”¨æˆ·</th>
                                <th>æ“ä½œ</th>
                                <th>èµ„æº</th>
                                <th>çŠ¶æ€</th>
                                <th>è¯¦æƒ…</th>
                            </tr>
                        </thead>
                        <tbody id="auditLogBody">
                            <!-- æ—¥å¿—æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ /ç¼–è¾‘è§’è‰²æ¨¡æ€æ¡† -->
    <div class="modal" id="roleModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="roleModalTitle">æ–°å»ºè§’è‰²</div>
                <button class="modal-close" onclick="closeRoleModal()">&times;</button>
            </div>
            <form id="roleForm" onsubmit="saveRole(event)">
                <div class="form-group">
                    <label class="form-label">è§’è‰²åç§° *</label>
                    <input type="text" class="form-input" id="roleName" required placeholder="è¯·è¾“å…¥è§’è‰²åç§°">
                </div>
                <div class="form-group">
                    <label class="form-label">è§’è‰²æè¿°</label>
                    <textarea class="form-textarea" id="roleDescription" placeholder="è¯·è¾“å…¥è§’è‰²æè¿°ï¼ˆå¯é€‰ï¼‰"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">è§’è‰²çº§åˆ«</label>
                    <select class="form-select" id="roleLevel">
                        <option value="1">ä¸€çº§ï¼ˆç³»ç»Ÿç®¡ç†å‘˜ï¼‰</option>
                        <option value="2">äºŒçº§ï¼ˆéƒ¨é—¨ç®¡ç†å‘˜ï¼‰</option>
                        <option value="3">ä¸‰çº§ï¼ˆæ™®é€šç”¨æˆ·ï¼‰</option>
                        <option value="4">å››çº§ï¼ˆè®¿å®¢ç”¨æˆ·ï¼‰</option>
                    </select>
                </div>
                <div class="btn-group" style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeRoleModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">ä¿å­˜è§’è‰²</button>
                </div>
            </form>
        </div>
    </div>

    <!-- æƒé™çŸ©é˜µæ¨¡æ€æ¡† -->
    <div class="modal" id="permissionMatrixModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <div class="modal-title">æƒé™çŸ©é˜µé…ç½®</div>
                <button class="modal-close" onclick="closePermissionMatrix()">&times;</button>
            </div>
            <div id="permissionMatrixContent">
                <!-- æƒé™çŸ©é˜µå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let roles = [];
        let permissions = [];
        let users = [];
        let auditLogs = [];
        let currentRole = null;
        let currentUser = null;

        // åˆå§‹åŒ–æ•°æ®
        function initializeData() {
            // æ¨¡æ‹Ÿè§’è‰²æ•°æ®
            roles = [
                {
                    id: 1,
                    name: 'ç³»ç»Ÿç®¡ç†å‘˜',
                    description: 'æ‹¥æœ‰ç³»ç»Ÿæ‰€æœ‰æƒé™çš„è¶…çº§ç®¡ç†å‘˜',
                    level: 1,
                    userCount: 3,
                    permissions: ['all'],
                    isSystem: true
                },
                {
                    id: 2,
                    name: 'çŸ¥è¯†åº“ç®¡ç†å‘˜',
                    description: 'ç®¡ç†çŸ¥è¯†åº“å†…å®¹å’Œæ–‡æ¡£',
                    level: 2,
                    userCount: 8,
                    permissions: ['doc.read', 'doc.write', 'doc.delete', 'tag.manage', 'category.manage'],
                    isSystem: false
                },
                {
                    id: 3,
                    name: 'æ•°æ®åˆ†æå¸ˆ',
                    description: 'è´Ÿè´£æ•°æ®åˆ†æå’ŒæŠ¥è¡¨ç”Ÿæˆ',
                    level: 2,
                    userCount: 12,
                    permissions: ['data.read', 'data.export', 'report.generate', 'query.execute'],
                    isSystem: false
                },
                {
                    id: 4,
                    name: 'æ™®é€šç”¨æˆ·',
                    description: 'åŸºæœ¬çš„æŸ¥è¯¢å’Œæµè§ˆæƒé™',
                    level: 3,
                    userCount: 85,
                    permissions: ['doc.read', 'query.execute', 'search.use'],
                    isSystem: false
                },
                {
                    id: 5,
                    name: 'è®¿å®¢ç”¨æˆ·',
                    description: 'å—é™çš„è®¿é—®æƒé™',
                    level: 4,
                    userCount: 20,
                    permissions: ['doc.read'],
                    isSystem: false
                }
            ];

            // æ¨¡æ‹Ÿæƒé™æ•°æ®
            permissions = [
                {
                    id: 'doc',
                    name: 'æ–‡æ¡£ç®¡ç†',
                    description: 'æ–‡æ¡£ç›¸å…³æ“ä½œæƒé™',
                    children: [
                        { id: 'doc.read', name: 'è¯»å–æ–‡æ¡£', description: 'æŸ¥çœ‹å’Œæœç´¢æ–‡æ¡£' },
                        { id: 'doc.write', name: 'ç¼–è¾‘æ–‡æ¡£', description: 'åˆ›å»ºå’Œä¿®æ”¹æ–‡æ¡£' },
                        { id: 'doc.delete', name: 'åˆ é™¤æ–‡æ¡£', description: 'åˆ é™¤æ–‡æ¡£å†…å®¹' },
                        { id: 'doc.import', name: 'å¯¼å…¥æ–‡æ¡£', description: 'æ‰¹é‡å¯¼å…¥æ–‡æ¡£' },
                        { id: 'doc.export', name: 'å¯¼å‡ºæ–‡æ¡£', description: 'å¯¼å‡ºæ–‡æ¡£å†…å®¹' }
                    ]
                },
                {
                    id: 'query',
                    name: 'æŸ¥è¯¢åŠŸèƒ½',
                    description: 'å„ç§æŸ¥è¯¢æ“ä½œæƒé™',
                    children: [
                        { id: 'query.execute', name: 'æ‰§è¡ŒæŸ¥è¯¢', description: 'æ‰§è¡Œå„ç§æŸ¥è¯¢æ“ä½œ' },
                        { id: 'query.sql', name: 'SQLæŸ¥è¯¢', description: 'æ‰§è¡ŒSQLæŸ¥è¯¢' },
                        { id: 'query.nlp', name: 'è‡ªç„¶è¯­è¨€æŸ¥è¯¢', description: 'ä½¿ç”¨è‡ªç„¶è¯­è¨€æŸ¥è¯¢' },
                        { id: 'query.advanced', name: 'é«˜çº§æŸ¥è¯¢', description: 'ä½¿ç”¨é«˜çº§æŸ¥è¯¢åŠŸèƒ½' }
                    ]
                },
                {
                    id: 'system',
                    name: 'ç³»ç»Ÿç®¡ç†',
                    description: 'ç³»ç»Ÿç®¡ç†ç›¸å…³æƒé™',
                    children: [
                        { id: 'system.config', name: 'ç³»ç»Ÿé…ç½®', description: 'ä¿®æ”¹ç³»ç»Ÿé…ç½®' },
                        { id: 'system.user', name: 'ç”¨æˆ·ç®¡ç†', description: 'ç®¡ç†ç”¨æˆ·è´¦æˆ·' },
                        { id: 'system.role', name: 'è§’è‰²ç®¡ç†', description: 'ç®¡ç†ç”¨æˆ·è§’è‰²' },
                        { id: 'system.backup', name: 'å¤‡ä»½ç®¡ç†', description: 'ç®¡ç†ç³»ç»Ÿå¤‡ä»½' },
                        { id: 'system.log', name: 'æ—¥å¿—ç®¡ç†', description: 'æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—' }
                    ]
                },
                {
                    id: 'data',
                    name: 'æ•°æ®ç®¡ç†',
                    description: 'æ•°æ®æ“ä½œæƒé™',
                    children: [
                        { id: 'data.read', name: 'è¯»å–æ•°æ®', description: 'æŸ¥çœ‹æ•°æ®å†…å®¹' },
                        { id: 'data.write', name: 'ç¼–è¾‘æ•°æ®', description: 'ä¿®æ”¹æ•°æ®å†…å®¹' },
                        { id: 'data.delete', name: 'åˆ é™¤æ•°æ®', description: 'åˆ é™¤æ•°æ®è®°å½•' },
                        { id: 'data.export', name: 'å¯¼å‡ºæ•°æ®', description: 'å¯¼å‡ºæ•°æ®å†…å®¹' },
                        { id: 'data.import', name: 'å¯¼å…¥æ•°æ®', description: 'å¯¼å…¥æ•°æ®æ–‡ä»¶' }
                    ]
                },
                {
                    id: 'tag',
                    name: 'æ ‡ç­¾ç®¡ç†',
                    description: 'æ ‡ç­¾å’Œåˆ†ç±»ç®¡ç†',
                    children: [
                        { id: 'tag.manage', name: 'ç®¡ç†æ ‡ç­¾', description: 'åˆ›å»ºç¼–è¾‘æ ‡ç­¾' },
                        { id: 'tag.category', name: 'ç®¡ç†åˆ†ç±»', description: 'ç®¡ç†æ ‡ç­¾åˆ†ç±»' },
                        { id: 'tag.assign', name: 'åˆ†é…æ ‡ç­¾', description: 'ç»™æ–‡æ¡£åˆ†é…æ ‡ç­¾' }
                    ]
                }
            ];

            // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®
            users = [
                {
                    id: 1,
                    name: 'å¼ ä¸‰',
                    email: 'zhangsan@company.com',
                    roleId: 1,
                    roleName: 'ç³»ç»Ÿç®¡ç†å‘˜',
                    status: 'active',
                    lastLogin: '2024-01-15 14:30:25',
                    permissions: ['all']
                },
                {
                    id: 2,
                    name: 'æå››',
                    email: 'lisi@company.com',
                    roleId: 2,
                    roleName: 'çŸ¥è¯†åº“ç®¡ç†å‘˜',
                    status: 'active',
                    lastLogin: '2024-01-15 09:15:42',
                    permissions: ['doc.read', 'doc.write', 'doc.delete', 'tag.manage']
                },
                {
                    id: 3,
                    name: 'ç‹äº”',
                    email: 'wangwu@company.com',
                    roleId: 3,
                    roleName: 'æ•°æ®åˆ†æå¸ˆ',
                    status: 'active',
                    lastLogin: '2024-01-14 16:45:18',
                    permissions: ['data.read', 'data.export', 'query.execute']
                },
                {
                    id: 4,
                    name: 'èµµå…­',
                    email: 'zhaoliu@company.com',
                    roleId: 4,
                    roleName: 'æ™®é€šç”¨æˆ·',
                    status: 'inactive',
                    lastLogin: '2024-01-10 11:20:33',
                    permissions: ['doc.read', 'query.execute']
                }
            ];

            // æ¨¡æ‹Ÿå®¡è®¡æ—¥å¿—
            auditLogs = [
                {
                    id: 1,
                    timestamp: '2024-01-15 14:35:10',
                    user: 'å¼ ä¸‰',
                    action: 'ä¿®æ”¹è§’è‰²æƒé™',
                    resource: 'çŸ¥è¯†åº“ç®¡ç†å‘˜',
                    status: 'success',
                    details: 'æ·»åŠ äº†æ–‡æ¡£å¯¼å…¥æƒé™'
                },
                {
                    id: 2,
                    timestamp: '2024-01-15 14:32:25',
                    user: 'æå››',
                    action: 'åˆ é™¤æ–‡æ¡£',
                    resource: 'æŠ€æœ¯æ–‡æ¡£/AIæŒ‡å—',
                    status: 'success',
                    details: 'åˆ é™¤äº†è¿‡æ—¶çš„AIæŒ‡å—æ–‡æ¡£'
                },
                {
                    id: 3,
                    timestamp: '2024-01-15 14:28:15',
                    user: 'ç‹äº”',
                    action: 'æ‰§è¡ŒæŸ¥è¯¢',
                    resource: 'æ•°æ®åˆ†æ/é”€å”®æŠ¥è¡¨',
                    status: 'failed',
                    details: 'æƒé™ä¸è¶³ï¼Œæ— æ³•è®¿é—®é”€å”®æ•°æ®'
                },
                {
                    id: 4,
                    timestamp: '2024-01-15 14:25:40',
                    user: 'èµµå…­',
                    action: 'ç™»å½•ç³»ç»Ÿ',
                    resource: 'ç³»ç»Ÿç™»å½•',
                    status: 'warning',
                    details: 'è¿ç»­3æ¬¡å¯†ç é”™è¯¯ï¼Œè´¦æˆ·è¢«é”å®š5åˆ†é’Ÿ'
                },
                {
                    id: 5,
                    timestamp: '2024-01-15 14:20:05',
                    user: 'å¼ ä¸‰',
                    action: 'åˆ›å»ºç”¨æˆ·',
                    resource: 'ç”¨æˆ·ç®¡ç†/æ–°å‘˜å·¥',
                    status: 'success',
                    details: 'ä¸ºæ–°å‘˜å·¥åˆ›å»ºè´¦æˆ·å¹¶åˆ†é…è§’è‰²'
                }
            ];

            renderRoles();
            renderPermissions();
            renderUsers();
            renderAuditLogs();
            updateStats();
            setupEventListeners();
        }

        // æ¸²æŸ“è§’è‰²åˆ—è¡¨
        function renderRoles() {
            const roleList = document.getElementById('roleList');
            
            roleList.innerHTML = roles.map(role => `
                <div class="role-item ${currentRole && currentRole.id === role.id ? 'active' : ''}" 
                     onclick="selectRole(${role.id})">
                    <div class="role-info">
                        <div class="role-name">${role.name}</div>
                        <div class="role-description">${role.description}</div>
                    </div>
                    <div class="role-count">${role.userCount}</div>
                </div>
            `).join('');
        }

        // é€‰æ‹©è§’è‰²
        function selectRole(roleId) {
            currentRole = roles.find(role => role.id === roleId);
            renderRoles();
            renderPermissions();
        }

        // æ¸²æŸ“æƒé™æ ‘
        function renderPermissions() {
            const permissionTree = document.getElementById('permissionTree');
            
            if (!currentRole) {
                permissionTree.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">è¯·é€‰æ‹©ä¸€ä¸ªè§’è‰²æ¥é…ç½®æƒé™</div>';
                return;
            }

            permissionTree.innerHTML = permissions.map(permissionGroup => `
                <div class="permission-group">
                    <div class="permission-header">
                        <div>
                            <div style="font-weight: 600;">${permissionGroup.name}</div>
                            <div style="font-size: 12px; color: #666;">${permissionGroup.description}</div>
                        </div>
                        <div class="permission-actions">
                            <button class="btn btn-sm btn-secondary" onclick="toggleGroupPermissions('${permissionGroup.id}')">
                                å…¨é€‰/å–æ¶ˆ
                            </button>
                        </div>
                    </div>
                    ${permissionGroup.children.map(permission => `
                        <div class="permission-item">
                            <div class="permission-info">
                                <div class="permission-name">${permission.name}</div>
                                <div class="permission-description">${permission.description}</div>
                            </div>
                            <div class="permission-actions">
                                <div class="permission-level">
                                    <button class="level-btn ${getPermissionLevel(currentRole.permissions, permission.id) === 'none' ? 'active' : ''}" 
                                            onclick="setPermissionLevel('${permission.id}', 'none')">
                                        æ— æƒé™
                                    </button>
                                    <button class="level-btn ${getPermissionLevel(currentRole.permissions, permission.id) === 'read' ? 'active' : ''}" 
                                            onclick="setPermissionLevel('${permission.id}', 'read')">
                                        åªè¯»
                                    </button>
                                    <button class="level-btn ${getPermissionLevel(currentRole.permissions, permission.id) === 'write' ? 'active' : ''}" 
                                            onclick="setPermissionLevel('${permission.id}', 'write')">
                                        è¯»å†™
                                    </button>
                                    <button class="level-btn ${getPermissionLevel(currentRole.permissions, permission.id) === 'admin' ? 'active' : ''}" 
                                            onclick="setPermissionLevel('${permission.id}', 'admin')">
                                        ç®¡ç†
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `).join('');
        }

        // è·å–æƒé™çº§åˆ«
        function getPermissionLevel(rolePermissions, permissionId) {
            if (rolePermissions.includes('all')) return 'admin';
            if (rolePermissions.includes(permissionId)) return 'write';
            return 'none';
        }

        // è®¾ç½®æƒé™çº§åˆ«
        function setPermissionLevel(permissionId, level) {
            if (!currentRole) return;
            
            // è¿™é‡Œåº”è¯¥å®ç°å®é™…çš„æƒé™æ›´æ–°é€»è¾‘
            console.log(`è®¾ç½®æƒé™ ${permissionId} ä¸ºçº§åˆ« ${level}`);
            
            // é‡æ–°æ¸²æŸ“æƒé™æ˜¾ç¤º
            renderPermissions();
        }

        // åˆ‡æ¢ç»„æƒé™
        function toggleGroupPermissions(groupId) {
            if (!currentRole) return;
            
            const permissionGroup = permissions.find(group => group.id === groupId);
            if (permissionGroup) {
                const allHavePermission = permissionGroup.children.every(permission => 
                    currentRole.permissions.includes(permission.id) || currentRole.permissions.includes('all')
                );
                
                if (allHavePermission) {
                    // å–æ¶ˆæ‰€æœ‰æƒé™
                    permissionGroup.children.forEach(permission => {
                        const index = currentRole.permissions.indexOf(permission.id);
                        if (index > -1) {
                            currentRole.permissions.splice(index, 1);
                        }
                    });
                } else {
                    // æ·»åŠ æ‰€æœ‰æƒé™
                    permissionGroup.children.forEach(permission => {
                        if (!currentRole.permissions.includes(permission.id)) {
                            currentRole.permissions.push(permission.id);
                        }
                    });
                }
                
                renderPermissions();
            }
        }

        // æ¸²æŸ“ç”¨æˆ·åˆ—è¡¨
        function renderUsers() {
            const userGrid = document.getElementById('userGrid');
            
            userGrid.innerHTML = users.map(user => `
                <div class="user-card">
                    <div class="user-header">
                        <div class="user-avatar">${user.name.charAt(0)}</div>
                        <div class="user-info">
                            <div class="user-name">${user.name}</div>
                            <div class="user-email">${user.email}</div>
                        </div>
                        <div class="user-role">${user.roleName}</div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                        <div>
                            <div style="font-size: 12px; color: #666;">æœ€åç™»å½•</div>
                            <div style="font-size: 12px;">${user.lastLogin}</div>
                        </div>
                        <div class="permission-actions">
                            <button class="btn btn-sm btn-primary" onclick="editUser(${user.id})">
                                ç¼–è¾‘
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteUser(${user.id})">
                                åˆ é™¤
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // æ¸²æŸ“å®¡è®¡æ—¥å¿—
        function renderAuditLogs() {
            const auditLogBody = document.getElementById('auditLogBody');
            
            auditLogBody.innerHTML = auditLogs.map(log => `
                <tr>
                    <td>${log.timestamp}</td>
                    <td>${log.user}</td>
                    <td>${log.action}</td>
                    <td>${log.resource}</td>
                    <td>
                        <span class="log-status ${log.status}">
                            ${log.status === 'success' ? 'æˆåŠŸ' : log.status === 'failed' ? 'å¤±è´¥' : 'è­¦å‘Š'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="showLogDetails(${log.id})">
                            è¯¦æƒ…
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalRoles').textContent = roles.length;
            
            const activePermissions = roles.reduce((total, role) => total + role.permissions.length, 0);
            document.getElementById('activePermissions').textContent = activePermissions;
            
            const securityEvents = auditLogs.filter(log => log.status !== 'success').length;
            document.getElementById('securityEvents').textContent = securityEvents;
        }

        // æ¨¡æ€æ¡†åŠŸèƒ½
        function showAddRoleModal() {
            document.getElementById('roleModalTitle').textContent = 'æ–°å»ºè§’è‰²';
            document.getElementById('roleForm').reset();
            document.getElementById('roleModal').classList.add('active');
        }

        function showAddUserModal() {
            alert('æ·»åŠ ç”¨æˆ·åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function showPermissionMatrix() {
            renderPermissionMatrix();
            document.getElementById('permissionMatrixModal').classList.add('active');
        }

        function closeRoleModal() {
            document.getElementById('roleModal').classList.remove('active');
        }

        function closePermissionMatrix() {
            document.getElementById('permissionMatrixModal').classList.remove('active');
        }

        // æ¸²æŸ“æƒé™çŸ©é˜µ
        function renderPermissionMatrix() {
            const content = document.getElementById('permissionMatrixContent');
            
            // è·å–æ‰€æœ‰æƒé™ID
            const allPermissions = [];
            permissions.forEach(group => {
                group.children.forEach(permission => {
                    allPermissions.push(permission);
                });
            });

            content.innerHTML = `
                <div class="permission-matrix">
                    <div class="matrix-header">èµ„æº/æ“ä½œ</div>
                    ${roles.map(role => `<div class="matrix-header">${role.name}</div>`).join('')}
                    
                    ${allPermissions.map(permission => `
                        <div class="matrix-cell resource">${permission.name}</div>
                        ${roles.map(role => `
                            <div class="matrix-cell">
                                <input type="checkbox" class="checkbox-custom" 
                                       ${role.permissions.includes(permission.id) || role.permissions.includes('all') ? 'checked' : ''}
                                       onchange="toggleMatrixPermission(${role.id}, '${permission.id}')">
                            </div>
                        `).join('')}
                    `).join('')}
                </div>
                <div style="margin-top: 20px; text-align: right;">
                    <button class="btn btn-primary" onclick="savePermissionMatrix()">ä¿å­˜çŸ©é˜µ</button>
                    <button class="btn btn-secondary" onclick="closePermissionMatrix()">å–æ¶ˆ</button>
                </div>
            `;
        }

        // åˆ‡æ¢çŸ©é˜µä¸­çš„æƒé™
        function toggleMatrixPermission(roleId, permissionId) {
            const role = roles.find(r => r.id === roleId);
            if (role) {
                const index = role.permissions.indexOf(permissionId);
                if (index > -1) {
                    role.permissions.splice(index, 1);
                } else {
                    role.permissions.push(permissionId);
                }
            }
        }

        // ä¿å­˜æƒé™çŸ©é˜µ
        function savePermissionMatrix() {
            closePermissionMatrix();
            alert('æƒé™çŸ©é˜µå·²ä¿å­˜ï¼');
        }

        // ä¿å­˜è§’è‰²
        function saveRole(event) {
            event.preventDefault();
            
            const name = document.getElementById('roleName').value;
            const description = document.getElementById('roleDescription').value;
            const level = parseInt(document.getElementById('roleLevel').value);
            
            const newRole = {
                id: Date.now(),
                name: name,
                description: description,
                level: level,
                userCount: 0,
                permissions: [],
                isSystem: false
            };
            
            roles.push(newRole);
            renderRoles();
            updateStats();
            closeRoleModal();
            alert('è§’è‰²åˆ›å»ºæˆåŠŸï¼');
        }

        // ç¼–è¾‘ç”¨æˆ·
        function editUser(userId) {
            const user = users.find(u => u.id === userId);
            if (user) {
                alert(`ç¼–è¾‘ç”¨æˆ·: ${user.name}`);
            }
        }

        // åˆ é™¤ç”¨æˆ·
        function deleteUser(userId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç”¨æˆ·å—ï¼Ÿ')) {
                users = users.filter(user => user.id !== userId);
                renderUsers();
                updateStats();
                alert('ç”¨æˆ·åˆ é™¤æˆåŠŸï¼');
            }
        }

        // æ˜¾ç¤ºæ—¥å¿—è¯¦æƒ…
        function showLogDetails(logId) {
            const log = auditLogs.find(l => l.id === logId);
            if (log) {
                alert(`æ—¥å¿—è¯¦æƒ…:\næ—¶é—´: ${log.timestamp}\nç”¨æˆ·: ${log.user}\næ“ä½œ: ${log.action}\nèµ„æº: ${log.resource}\nçŠ¶æ€: ${log.status}\nè¯¦æƒ…: ${log.details}`);
            }
        }

        // æœç´¢åŠŸèƒ½
        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                // å®ç°æœç´¢é€»è¾‘
                console.log('æœç´¢:', searchTerm);
            });
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initializeData);
    </script>
</body>
</html>